<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>KanbanDo</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div
      id="app"
      class="min-h-screen bg-gray-100 font-sans"
    >
      <!-- Loading state -->
      <div v-if="isCheckingAuth" class="min-h-screen flex items-center justify-center">
        <div class="text-gray-600">Loading...</div>
      </div>
      
      <!-- Login form -->
      <login-form
        v-else-if="!isAuthenticated"
        @login-success="handleLogin"
      ></login-form>
      
      <!-- Main app -->
      <template v-else>
        <app-header
          :current-user="currentUser"
          @delete-unused-images="deleteUnusedImages"
          @delete-all-done-tasks="deleteDoneTasks"
          @logout="logout"
        ></app-header>

      <kanban-board
        :tasks="tasks"
        :statuses="statuses"
        @view-task="viewTask"
        @view-full-image="viewFullImage"
        @delete-done-tasks="deleteDoneTasks"
        @open-modal="openModal"
      ></kanban-board>

      <task-modal
        :show-modal="showModal"
        :editing-task="editingTask"
        :task-form="taskForm"
        :image-previews="imagePreviews"
        :is-drag-over="isDragOver"
        @close-modal="closeModal"
        @save-task="saveTask"
        @confirm-delete-task="confirmDeleteTask"
        @handle-file-select="handleFileSelect"
        @handle-drop="handleDrop"
        @remove-image="removeImage"
      ></task-modal>

      <delete-modal
        :show-delete-modal="showDeleteModal"
        :done-tasks-count="getDoneTasksCount()"
        @close-delete-modal="closeDeleteModal"
        @confirm-delete-done-tasks="confirmDeleteDoneTasks"
      ></delete-modal>

      <view-modal
        :show-view-modal="showViewModal"
        :viewing-task="viewingTask"
        @close-view-modal="closeViewModal"
        @edit-from-view="editFromView"
        @view-full-image="viewFullImage"
      ></view-modal>

      <image-modal
        :show-image-modal="showImageModal"
        :full-size-image="fullSizeImage"
        @close-image-modal="closeImageModal"
      ></image-modal>

        <confetti ref="confetti"></confetti>
      </template>
    </div>

    <script src="components/Login.js"></script>
    <script src="components/Header.js"></script>
    <script src="components/DropdownMenu.js"></script>
    <script src="components/KanbanBoard.js"></script>
    <script src="components/TaskModal.js"></script>
    <script src="components/DeleteModal.js"></script>
    <script src="components/ViewModal.js"></script>
    <script src="components/ImageModal.js"></script>
    <script src="components/Confetti.js"></script>
    <script src="vue.js"></script>
  </body>
</html>
